---
paths:
  - ".claude/skills/**/*.md"
  - ".claude/agents/**/*.md"
  - ".claude/output-styles/**/*.md"
  - ".claude/commands/**/*.md"
---

# Claude 設定ファイル作成ルール

## 命名規約

**形式**: `動名詞形`（動詞 + -ing）、小文字、ハイフン、最大64文字

```yaml
# 良い例
name: processing-pdfs
name: managing-agents

# 悪い例
name: PDF-Processor    # 動名詞でない、大文字
name: helper           # 曖昧すぎる
```

## description（重要）

**テンプレート**: `[機能の説明]. Use when [トリガー].`

**要件**:
- 最大1024文字
- 三人称
- WHAT（機能）と WHEN（トリガー）を含む
- 山括弧禁止（`<example>` は不可）

```yaml
# 良い例
description: PDFファイルからテキストを抽出します。PDFを扱う場合や「PDF」「PDF処理」に言及された場合に使用。

# 悪い例
description: Helps with documents  # 曖昧、トリガーなし
```

## ファイルサイズ制限

- `SKILL.md` / `AGENT.md`: 500行以下
- すべての文の必要性を精査
- 詳細な内容はリファレンスファイルに移動

## 言語ガイドライン

| ファイルタイプ | 言語 |
|---------------|------|
| SKILL.md / AGENT.md | 日本語 |
| rules/*.md | 日本語 |
| output-styles/*.md | 日本語 |
| CLAUDE.md | 日本語 |
| description (SKILL.md frontmatter) | 日本語 + 英語技術用語（下記参照） |

- **避ける**: 重いテーブルフォーマット（トークン非効率）
- **EN版 description**: 英語キーワードのみ（日本語トリガー不要）
- **JA版 description**: 日本語 + 日本語ユーザーが実際に使う英語技術用語（例: 「コミット」+「commit」）
- **存在しないスラッシュコマンド禁止**: `/skill-name` は実在するコマンドのみ参照可。引用符付きキーワードを使用（例: 「commit」であって「/commit」ではない）

## ファイル構造

```
skill-name/
├── SKILL.md        # 必須、500行以下
├── reference.md    # オプション、詳細仕様
├── examples.md     # オプション、I/O 例
└── scripts/        # オプション、自動化
```

## コンテキスト効率原則

制約が多いほど LLM の遵守率が低下する。ロール別に密度を調整すること。

### ロール別密度方針

| ロール | 制約密度 | 理由 |
|--------|---------|------|
| **レビュアー** (`context: fork`) | 多くてOK | 観察・報告タスクは遵守率が高い |
| **コーダー** | 最小限に | コード生成 + 制約遵守の複合タスク |

### 執筆原則

- **Name it, don't explain it**: 既知概念は名前で参照（例: "Conventional Commits に従う" で十分）
- **Detail only project-specific**: プロジェクト固有ルールのみ詳述
- **Consolidate, don't scatter**: 同じルールを複数ファイルに分散させない
- **Compress, don't expand**: 冗長なテーブルは箇条書きやインラインに圧縮

### LLM に任せてよいもの

- 既知概念の説明（Git Flow, TDD, Conventional Commits 等）
- 一般的なベストプラクティス
- 言語・フレームワークの基本構文

## SKILL.md 必須コンテンツ

圧縮時でも以下は**削除してはならない**。

### 1. ワークフロー（必須）

ステップバイステップの作業フローは省略不可。LLM はフローを推測できるが、プロジェクト固有の順序・条件分岐・ゲートは明記が必要。

```markdown
## ワークフロー
### Step 1: 準備
...
### Step 2: 実行
...
### Step 3: 検証
...
```

### 2. ツール使用タイミング（必須）

スキル内でいつどのツールを使うかを明記:
- **TodoWrite**: 3ステップ以上の作業、マルチ Issue 時
- **AskUserQuestion**: 判断が必要な分岐点、複数アプローチの選択
- **Task**: 並行調査、フォーク実行
- **EnterPlanMode**: スキルワークフローでは不要（計画は Issue 本文に書き出し、Spec Review で承認を管理するため。`plansDirectory` は万が一の安全策として設定済み）

ツール指示がないと LLM は自己判断で使用をスキップする。

### 3. NGケース / チェックリスト（必須）

そのスキル固有の「やってはいけないこと」を明示:
- 一般的な NG ではなく**プロジェクト固有の NG** を記載
- 例: committing-on-issue → `--no-verify` 禁止、`Co-Authored-By` 不要
- 例: creating-pr-on-issue → ベースブランチへの直接プッシュ禁止

完了条件や品質ゲートもチェックリストで明示:

```markdown
## チェックリスト
- [ ] ビルドが通ること
- [ ] ユーザーに確認を取ったこと
```

### 4. 出力テンプレート内蔵（推奨）

スキルが Task や fork で呼び出される場合、出力形式はスキル自身が保持すべき。呼び出し側が出力テンプレートを prompt に埋め込む設計は避ける。

```
# NG: 呼び出し側が出力形式を定義
Task(prompt: "レビューして。出力は以下の形式で: ## 結果\n| 項目 | 判定 |...")

# OK: スキル側が出力形式を保持
Skill("reviewing-on-issue")  # 出力形式はスキル内に定義済み
```

**原則**:
- スキルは自身の出力テンプレートを SKILL.md 内または reference ファイルに保持する
- 呼び出し側は入力データ（Issue 番号、対象ファイル等）のみ渡す
- 出力形式の変更はスキル側を1箇所修正するだけで済む

**良い例**: reviewing-on-issue（Self-Review Result テンプレートを内蔵）、claude-config-reviewing（品質チェックリストを内蔵）

## アンチパターン

- 深い参照チェーン（SKILL.md から1レベルに保つ）
- Windows のバックスラッシュ（フォワードスラッシュのみ）
- デフォルトなしのオプション過多
- 具体的なトリガーのない曖昧な命名
- LLM が知っている概念の長い説明
- 動機付け・哲学セクション（"なぜ" より "何を"）
- **ワークフローの省略**（フローは LLM に推測させてはいけない）
- **ツール使用指示の省略**（TodoWrite, AskUserQuestion 等の使い所）
- **NGケースの省略**（禁止事項がないと LLM はデフォルト動作する）

## バリデーションチェックリスト

コミット前に確認：
- [ ] 名前: 動名詞形、小文字
- [ ] description: トリガー、三人称、`<>` なし
- [ ] SKILL.md: 500行以下
- [ ] フロントマター: 有効な YAML（タブではなくスペース）
- [ ] パス: フォワードスラッシュのみ
- [ ] **ワークフロー**: ステップバイステップのフローが記載されているか
- [ ] **ツール使用**: TodoWrite / AskUserQuestion / Task の使い所が明記されているか
- [ ] **NGケース**: スキル固有の禁止事項・チェックリストがあるか
- [ ] コーダー系: 既知概念の説明を削除し参照のみにしたか
- [ ] レビュアー系: チェックリストの網羅性は十分か
