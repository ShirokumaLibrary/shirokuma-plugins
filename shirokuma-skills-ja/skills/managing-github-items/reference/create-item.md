# /create-item ワークフロー

Issue または DraftIssue を作成する。引数なしの場合、会話コンテキストから自動推定する。

```
/create-item                    # コンテキスト自動推定モード
/create-item "タイトル"          # タイトル指定
```

## ステップ 1: 詳細収集 + 種別判定

引数あり: 指定されたタイトルを使用。
引数なし: 会話コンテキストから以下を推定する。

| 推定対象 | 情報源 | 推定方法 |
|---------|--------|---------|
| タイトル | 直前のユーザー発話 | 「Issue にして」の前に述べられた問題・機能の要約 |
| **種別** | 会話コンテキスト | 下記「種別判定」参照 |
| Type（Issue Types） | 種別から決定 | feature → Feature、bug → Bug、chore → Chore、research → Task（`--issue-type` オプションで指定） |
| ラベル（area） | 会話コンテキスト | 影響範囲から推定: CLI 関連 → `area:cli`、プラグイン関連 → `area:plugin` 等 |
| Priority | 会話コンテキスト | 緊急性の表現（「すぐ」→ High、通常 → Medium） |
| 本文 | 種別テンプレート | ステップ 2 の種別テンプレートに従って構造化 |
| Size | タスク推定 | タスク数・影響範囲から推定（デフォルト S） |

### 種別判定

| キーワード | 種別 |
|-----------|------|
| 新機能、追加、implement、create、add | feature |
| バグ、修正、fix、bug、エラー | bug |
| リファクタリング、改善、設定、chore、refactor、内部 | chore |
| 調査、検証、比較、research、evaluate | research |

### 目的の明確性チェック

Issue 作成時、ユーザーの指示から「誰が・何を・なぜ」を推定できるか確認する。

| 状態 | アクション |
|------|----------|
| 目的を推定できる | 推定した目的をテンプレートに記入 |
| 目的が不明確 | 候補を 2〜3 個提案し AskUserQuestion で選択を求める（目的なしでの作成はブロック） |

```
例: ユーザー「deps コマンドに --format オプション追加して」

提案:
A) 「CLI ユーザーが出力形式を用途に応じて選べるようにする。現在 SVG のみで、CI やドキュメントへの埋め込みに不便なため。」
B) 「CLI ユーザーが JSON 形式で依存情報を取得できるようにする。他ツールとのパイプライン連携のため。」
C) その他（具体的に教えてください）
```

ラベル一覧（影響範囲分類用 — area ラベル）:

| ラベル | 用途 |
|--------|------|
| `area:cli` | CLI コマンド関連 |
| `area:plugin` | プラグイン関連 |
| `area:portal` | ポータルサイト関連 |
| `area:docs` | ドキュメント関連 |

## ステップ 2: 本文生成

種別に応じたテンプレートを使用する。全種別で `## 目的` セクションを必須とする。

### feature（新機能）

```markdown
## 目的
{ロール}が{機能}できるようにする。{ユーザー価値}。

## 概要
{技術的な説明}

## 背景
{現状の問題、関連する制約や依存関係}

## タスク
- [ ] タスク 1

## 成果物
{完了の定義 — ユーザーが確認できる結果を含める}
```

**目的の例**: 「CLI ユーザーが依存グラフを SVG 形式で出力できるようにする。プロジェクト構造を視覚的に把握し、新メンバーのオンボーディングを効率化するため。」

### bug（バグ修正）

```markdown
## 目的
{ロール}が{正常な動作}できるようにする。{現在の問題}。

## 概要
{バグの技術的な説明}

## 再現手順
1. ステップ 1
2. ステップ 2

## 期待動作
{本来の正しい動作}

## タスク
- [ ] タスク 1

## 成果物
{修正の確認方法}
```

**目的の例**: 「CLI ユーザーが `deps` コマンドを正常に実行できるようにする。現在、循環依存があるプロジェクトで無限ループが発生するため。」

### chore（内部改善・リファクタリング）

```markdown
## 目的
開発者が{何}できるようにする。{現状の課題}。

## 概要
{技術的な説明}

## 背景
{改善の動機、現状の問題点、定量的な根拠があれば記載}

## タスク
- [ ] タスク 1

## 成果物
{改善の確認方法 — 可能なら定量指標}
```

**目的の例**: 「開発者がテストを高速に実行できるようにする。現在 CI で 8 分かかっており、フィードバックループが遅いため。」

### research（調査）

```markdown
## 目的
チームが{判断対象}について技術選定/意思決定できるようにする。{未確定事項}。

## 概要
{調査の範囲}

## 調査項目
- [ ] 調査 1

## 判断基準
{何が分かれば完了か}

## 成果物
{調査結果の出力形式 — Discussion / ADR / 比較表}
```

**目的の例**: 「チームが全文検索の実装方法を選定できるようにする。現在 JSON インデックスを使用しているが、スケーラビリティが未検証のため。」

### 軽量 Issue の扱い

タイポ修正、1行変更など XS サイズの Issue:
- 目的セクションは1文で十分（例: 「ユーザーがドキュメントを正しく読めるようにする。タイポがあるため。」）
- 背景セクションは省略可

> **背景セクション**: 計画レビュー（`planning-on-issue` ステップ 4）で、Issue 本文だけから計画を評価する。背景・制約・依存関係が不足していると、レビュアーが NEEDS_REVISION を返す。軽量な Issue（タイポ修正等）では 1 行で十分。

## ステップ 3: フィールド設定

| フィールド | 選択肢 | デフォルト |
|-----------|--------|----------|
| Priority | Critical / High / Medium / Low | Medium |
| Size | XS / S / M / L / XL | S |
| Status | Backlog / Ready | Backlog |

## ステップ 4: 作成

### 一時ファイル命名規約

Issue 番号は GitHub が作成時に採番するため、作成前には不明。予測番号を一時ファイル名に使わないこと。

| タイミング | パターン | 例 |
|-----------|---------|-----|
| 作成前 | `/tmp/{slug}-body.md` | `/tmp/add-format-option-body.md` |
| 作成後 | `/tmp/issue-{number}-body.md` 可 | `/tmp/issue-42-body.md` |

```bash
# Issue（推奨 — #番号をサポート）
shirokuma-docs issues create \
  --title "Title" --body /tmp/add-format-option-body.md \
  --labels "area:cli" --issue-type "Feature" \
  --field-status "Backlog" --priority "Medium" --size "M"

# DraftIssue（軽量）
shirokuma-docs projects create \
  --title "Title" --body /tmp/add-format-option-body.md \
  --field-status "Backlog" --priority "Medium"
```

## ステップ 5: 結果表示と作成後レビュー

```markdown
## アイテム作成完了
**Issue:** #123 | **ラベル:** area:cli | **優先度:** Medium | **ステータス:** Backlog

GitHub 上で Issue の本文を確認してください。タイトル・本文・フィールドに修正が必要であれば指示してください。
```

結果表示後、チェーン判定に進む前にユーザーが内容を確認し修正指示を出す機会を設ける。
