# アイテム本文メンテナンス詳細手順

Issues / Discussions / PRs 共通。`project-items` ルールの概要セクション補足。

## 更新タイミング

| トリガー | アクション |
|---------|----------|
| コメントで新しい知見・訂正を追加 | 本文に統合 |
| 調査結果をコメントで投稿 | 本文の該当セクションに反映 |
| 要件がコメントで変更 | 本文のタスク・成果物セクションを更新 |
| 決定事項がコメントで発生 | 本文に記録 |
| コメント3件以上蓄積 | 本文に統合 |

## 更新方法

```bash
# Issues（Write ツールでファイル作成後）
shirokuma-docs issues update {number} --body /tmp/shirokuma-docs/body.md

# Discussions（Write ツールでファイル作成後）
shirokuma-docs discussions update {number} --body /tmp/shirokuma-docs/body.md
```

## ワークフロー順序（コメントファースト）

本文を更新する際は、必ず以下の順序で行う:

1. **コメントを投稿** — 変更内容・知見・訂正をコメントとして記録する
2. **本文に統合** — コメントの内容を本文の該当セクションに反映する

この順序により、コメント履歴に「何を変えたか」の経緯が残り、AI の判断ミスやハルシネーションの検出・改善が可能になる。

**禁止**: 本文を直接更新してからコメントを後付けする（逆順）。コメントなしで本文を更新する。

## 実質的遵守

形式的にコメント→本文の順序を守るだけでは不十分。コメントが**作業の一次記録**として独立した価値を持つ必要がある。

**判定ヒューリスティック**: コメントを削除しても、本文にない情報が失われないなら、そのコメントは実質的ではない。

| 悪い例（形式的遵守） | 良い例（実質的遵守） |
|---------------------|---------------------|
| 「計画を策定しました。詳細は本文参照。」 | 「アプローチ A を選定。B 案（〇〇）も検討したが、△△の理由で却下。」 |
| 「Issue 本文を更新しました。」 | 「調査の結果、X モジュールにも影響があることが判明。タスクに追加。」 |
| 「レビュー結果を反映しました。」 | 「レビューで N 件の問題を検出: {具体的な所見の要約}」 |

**コメントが一次記録であるべき内容**:
- 判断の根拠・検討した代替案
- 調査で発見した事実
- レビュー所見の要約
- 要件変更の理由

**本文への統合時**: コメントの内容を構造化して該当セクションにマージする。コメントはそのまま履歴として残る。

## レビュー結果からの本文更新

`reviewing-on-issue` が PR コメントや Issue コメントにレビュー結果を投稿した後、呼び出し元スキルが本文を更新する場合の手順パターン。

### 手順

1. **レビューコメントが投稿済みであることを確認** — `reviewing-on-issue` のステップ 6 でコメント投稿が完了している
2. **本文の該当セクションに統合** — レビュー結果に基づきタスクリストの更新や新しいセクションの追加を行う

### 具体例

| シナリオ | コメント（投稿済み） | 本文への統合 |
|---------|---------------------|------------|
| レビューでタスク漏れ発見 | 「レビューで X の処理が未実装であることを検出。タスクに追加。」 | タスクセクションに `- [ ] X の処理を追加` を追記 |
| セキュリティ指摘 | 「セキュリティレビューで認証チェック漏れを 2 件検出: {具体的箇所}」 | タスクセクションに修正タスクを追加 |
| 計画レビューの改善提案 | 「計画レビューで A モジュールへの影響が計画に含まれていないことを指摘。」 | 計画セクションの変更対象ファイルに追加 |

### 注意

- `reviewing-on-issue` は `context: fork` で動作するため、コメント投稿のみを行い本文更新は行わない
- 本文更新は呼び出し元スキル（`creating-pr-on-issue`, `working-on-issue`）の責任
- レビューコメント自体が一次記録として機能するため、追加のコメント投稿は不要（レビューコメント = コメントファーストの「コメント」に該当）

## ガイドライン

1. **構造保持** — 元のテンプレートセクションを維持
2. **タスクチェック更新** — 完了項目をチェック、新規タスクを追加
3. **要約して重複排除** — コメントスレッドを簡潔に統合
4. **コメントファースト遵守** — 本文更新前に必ずコメントを投稿する（上記ワークフロー順序参照）
