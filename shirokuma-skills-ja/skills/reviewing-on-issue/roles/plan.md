# 計画レビューロール

## 責務

Issue 本文の計画セクション（`## 計画`）の品質レビュー:
- 要件カバレッジ（概要・タスクの全要件が計画で漏れなくカバーされているか）
- 変更ファイルの妥当性（漏れや余分なファイルはないか）
- タスク粒度（1タスク ≈ 1コミットの原則）
- リスク分析（破壊的変更、パフォーマンス影響の見落とし）
- Issue 記述の十分性（Issue 本文だけで計画を理解・評価できるか）

## `planning-on-issue` との使い分け

| 観点 | `planning-on-issue` 内蔵レビュー | `reviewing-on-issue` plan ロール |
|------|--------------------------------|--------------------------------|
| タイミング | 計画策定直後の即時チェック | ユーザーが任意タイミングで依頼 |
| データ取得 | Task エージェントに Issue 本文を埋め込み | Issue 番号から `shirokuma-docs issues show` で取得 |
| 目的 | 計画の初期品質ゲート | 独立したセカンドオピニオン |
| 起動方法 | `planning-on-issue` のステップ 4 で自動実行 | `/reviewing-on-issue plan #N` または Spec Review Issue 指定 |

## 必要な知識

以下のファイルをコンテキストとして読み込む:
- プロジェクトの `CLAUDE.md` - プロジェクト概要と規約
- `.claude/rules/` - プロジェクト固有のルール（自動読み込み）

## plan ロール固有ワークフロー

```
1. ロール選択: "plan review" or Spec Review Issue
2. Issue 本文取得: shirokuma-docs issues show {number}
3. Lint 実行: スキップ（対象がコードファイルではないため）
4. 計画分析: Issue 本文の「## 計画」セクションをレビュー観点で分析
5. レポート生成: テンプレート形式
6. レポート保存: Issue コメント
```

## レビューチェックリスト

### 要件カバレッジ
- [ ] Issue の「概要」セクションの全要件が計画でカバーされている
- [ ] Issue の「タスク」セクションの全タスクが計画のタスク分解に対応している
- [ ] 「成果物」セクションの各項目に対応するタスクが存在する
- [ ] 暗黙の要件（テスト、バージョンバンプ等）が見落とされていない

### 変更ファイルの妥当性
- [ ] 変更対象ファイル一覧が記載されている
- [ ] 漏れているファイルがない（要件から推測される変更対象が全て含まれている）
- [ ] 余分なファイルが含まれていない（スコープ外の変更がない）
- [ ] 新規作成と既存更新が明確に区別されている

### タスク粒度
- [ ] 各タスクが具体的で実行可能（「実装する」だけでなく、何をどう変更するか記載）
- [ ] 1タスク ≈ 1コミットの粒度
- [ ] タスク間の依存関係が明確（順序が論理的）
- [ ] タスクが多すぎず少なすぎない（Issue のサイズに適切）

### リスク分析
- [ ] 破壊的変更がある場合、その影響範囲が記載されている
- [ ] パフォーマンスへの影響が考慮されている
- [ ] 既存機能への影響が評価されている
- [ ] ロールバック手順または影響軽減策がある（必要な場合）

### Issue 記述の十分性
- [ ] Issue 本文だけで計画の全体像を理解できる
- [ ] アプローチの根拠（なぜこの方法を選んだか）が記載されている
- [ ] 代替案の検討結果が記載されている（該当する場合）
- [ ] 前提条件や制約が明記されている

## 検出すべきアンチパターン

### 計画セクション不在
- [ ] `## 計画` セクションが存在しない
- [ ] 計画セクションが空または不十分（見出しのみで内容なし）

### タスクが抽象的すぎる
- [ ] 「実装する」「修正する」のみで具体的な変更内容なし
- [ ] 変更するファイルや関数が特定されていない
- [ ] 成果物との対応が不明確

### 変更ファイル一覧の欠落
- [ ] 標準/詳細レベルの計画なのに変更ファイル一覧がない
- [ ] ファイルパスが不正確（存在しないパスを参照）

### リスク記載の欠落
- [ ] 詳細レベルの計画なのにリスク分析がない
- [ ] 破壊的変更があるのに影響範囲の記載がない

### 成果物との不整合
- [ ] 「成果物」セクションに対応するタスクがない
- [ ] タスクは完了条件を満たすのに成果物と乖離
- [ ] 成果物が曖昧（「動作すること」のみ）

## レポート形式

`templates/report.md` のテンプレートを使用:

1. **概要**: 計画品質の全体サマリー
2. **重大な問題**: 要件漏れ、重大な不整合
3. **改善提案**: タスク粒度の改善、リスク追記等
4. **良い実践**: 適切な計画パターン
5. **推奨事項**: 優先度順のアクション項目

## トリガーキーワード

- "plan review"
- "計画レビュー"
- "review plan"
- "計画チェック"
