# レビューレポートテンプレート

## ヘッダー

```markdown
# [レビュータイプ] レビューレポート

**日付**: YYYY-MM-DD HH:MM
**レビュアー**: Claude (reviewer agent)
**対象**: [ファイル/ディレクトリパス]
**ロール**: [code|security|testing|nextjs|plan]
```

## セクション

### 1. サマリー

概要（2-3文）:
- レビュー対象
- 総合評価（Good/Needs Work/Critical）
- 主要な発見事項

### 2. 重大な問題

**マージ前に修正必須**（[深刻度定義](#深刻度定義)参照）

| 問題 | 場所 | 深刻度 | 説明 |
|------|------|--------|------|
| 問題名 | file:line | Critical/High | 問題の内容と理由 |

### 3. 改善提案

**推奨される変更**（[深刻度定義](#深刻度定義)参照）

| 問題 | 場所 | 深刻度 | 説明 |
|------|------|--------|------|
| 問題名 | file:line | Medium/Low | 改善内容 |

### 4. 良い実践

**ポジティブな発見**

- 良くできている点
- 正しく適用されたパターン
- 他で再利用すべき良い例

### 5. 推奨事項

**優先度順のアクション項目**

1. **即時対応**: Critical な修正
2. **マージ前**: 重要な改善
3. **将来**: 技術的負債

---

## レポート例

```markdown
# セキュリティレビューレポート

**日付**: 2025-11-28 14:30
**レビュアー**: Claude (reviewer agent)
**対象**: apps/admin/lib/actions/
**ロール**: security

## サマリー

Server Action ファイル5件をレビュー。全体的なセキュリティ体制は **Good** だが、Critical な問題が1件: `deleteComment` の認可チェック欠落。その他のアクションはセキュアなパターンに従っている。

## 重大な問題

| 問題 | 場所 | 深刻度 | 説明 |
|------|------|--------|------|
| 認可チェック欠落 | comments.ts:45 | Critical | `deleteComment` にセッション検証がない |
| ILIKE インジェクション | posts.ts:112 | High | 検索クエリがエスケープされていない |

## 改善提案

| 問題 | 場所 | 深刻度 | 説明 |
|------|------|--------|------|
| レート制限 | auth.ts:23 | Medium | パスワードリセットにより厳しい制限を検討 |
| エラーログ | categories.ts:78 | Low | 構造化ログコンテキストを追加 |

## 良い実践

- 全アクションで Zod バリデーションを使用
- 投稿ミューテーションで適切な所有権チェック
- 構造化されたエラーレスポンス
- revalidatePath を一貫して使用

## 推奨事項

1. **即時対応**: `deleteComment` に認可チェックを追加
2. **マージ前**: 検索の ILIKE ワイルドカードをエスケープ
3. **将来**: 重要なアクションにレート制限を実装
```

## 深刻度定義

| レベル | 影響 | アクション |
|--------|------|----------|
| **Critical** | セキュリティ脆弱性、データ損失リスク | マージをブロック |
| **High** | 重大なバグ、セキュリティギャップ | マージ前に修正 |
| **Medium** | パフォーマンス問題、保守性 | 修正推奨 |
| **Low** | スタイルの問題、軽微な改善 | 後日対応 |

## 出力先

**Reports カテゴリに Discussion を作成:**

```bash
shirokuma-docs discussions create \
  --category Reports \
  --title "[レビュー] security: apps/admin/lib/actions/" \
  --body report.md
```

Discussion の URL をユーザーに報告する。

> 出力先ポリシーは `rules/output-destinations.md` 参照。
