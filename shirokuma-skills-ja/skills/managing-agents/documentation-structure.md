# エージェントドキュメント構造

複雑なエージェントのナレッジベースを明確なファイル責務と単一情報源の原則で整理する。

---

## 使用場面

エージェントが以下を必要とする場合:
- 複数の参照ドキュメント (> 3ファイル)
- トピック別のパターンファイル
- コード生成用テンプレート
- 品質ゲート用チェックリスト

単純なエージェント（AGENT.md が500行未満）では不要。

---

## ディレクトリ構造

パス: `.claude/agents/{agent-name}/`

## ファイル責務

| ファイル | 責務 | 内容 | サイズ上限 |
|---------|------|------|----------|
| **AGENT.md** | ワークフロー | ステップバイステッププロセスのみ | < 500行 |
| **reference.md** | クイックリファレンス | ドキュメント構造、技術スタック、パターン一覧、既知の問題 | < 800行 |
| **checklists.md** | 品質ゲート | 完了前チェックリスト | < 300行 |
| **patterns/*.md** | 詳細パターン | 単一トピック、唯一の情報源 | 80-150行 |
| **templates/README.md** | テンプレート仕様 | テンプレート一覧と使用法 | < 300行 |

---

## 単一情報源の原則

### ルール

> 情報は正確に1箇所にのみ記述。他のファイルには参照のみ。

### 例

**良い例**: reference.md にリンク付きテーブルのみ

```markdown
## Quick Reference

| Pattern | File | Summary |
|---------|------|---------|
| Auth | [better-auth.md](patterns/better-auth.md) | Two-function pattern |
| CSRF | [csrf-protection.md](patterns/csrf-protection.md) | Token validation |
```

**悪い例**: reference.md が patterns/ のコードを重複

### 重複が許容される場合

- 即座に見える必要がある**クリティカルなパターン**（最大1-2個）
- 5行未満の**構文例**
- **必ず** "→ Details: [file.md](path)" 参照を追加

---

## パターンファイルの形式

```markdown
# {Pattern Name}

{このパターンが解決する内容の一文説明}

---

## Solution

{主要なコード例}

\```typescript
// Code here
\```

---

## Usage

{このパターンを使用する場面}

- Condition 1
- Condition 2

---

## Key Points

- {重要なポイント 1}
- {重要なポイント 2}
- {重要なポイント 3}
```

### 必須セクション

| セクション | 必須 | 内容 |
|-----------|------|------|
| `# Title` | はい | パターン名 |
| Overview | はい | タイトル下の1-2文 |
| `## Solution` | はい | 主要なコード例 |
| `## Key Points` | はい | 3-5個の箇条書き |

### オプションセクション

| セクション | ユースケース |
|-----------|------------|
| `## Problem` | エラー/問題の説明が必要 |
| `## Usage` | 使用場面の説明 |
| `## Examples` | 追加コード例 |
| `## Configuration` | 設定ファイル例 |
| `## Testing` | テスト方法 |

---

## ファイル長のガイドライン

| 行数 | アクション |
|------|----------|
| < 50行 | 関連ファイルとの統合を検討 |
| 80-150行 | 理想的 |
| 150-200行 | 許容範囲 |
| > 200行 | 分割を検討 |
| > 500行 | 分割必須またはディレクトリ形式 |

---

## スタイルルール

### セクション区切り

主要セクションの前に `---` を使用。

### コードブロック

言語を必ず指定:

```markdown
\```typescript
// Not just \```
\```
```

### 箇条書き

- 動詞で始める ("Use", "Check", "Avoid")
- 完全な文を推奨
- 並列構造

### 見出し

```markdown
# Pattern Name        ← Title Case
## Section Name       ← Title Case
### Sub-section name  ← Sentence case
```

---

## 重要なポイント

- 3つ以上の参照ファイルを持つエージェントにはディレクトリ形式を使用
- 各ファイルは1つの責務 - 重複なし
- パターンファイルが唯一の情報源 - reference.md はリンクのみ
- パターンファイルは可読性のため80-150行
- 明確化のため reference.md に Document Structure セクションを追加
